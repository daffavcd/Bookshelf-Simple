<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Bookshelf Apps</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header class="head_bar">
        <h1 class="head_bar__title">Bookshelf Apps</h1>
    </header>
    <main>
        <section class="input_section">
            <h2>Masukkan Buku Baru</h2>
            <form id="inputBook" onsubmit="return insert_buku()">
                <div class="input">
                    <label for="inputBookTitle">Judul</label>
                    <input id="inputBookTitle" type="text" required>
                </div>
                <div class="input">
                    <label for="inputBookAuthor">Penulis</label>
                    <input id="inputBookAuthor" type="text" required>
                </div>
                <div class="input">
                    <label for="inputBookYear">Tahun</label>
                    <input id="inputBookYear" type="number" required>
                </div>
                <div class="input_inline">
                    <label for="inputBookIsComplete">Selesai dibaca</label>
                    <input id="inputBookIsComplete" type="checkbox">
                </div>
                <button id="bookSubmit" type="submit">Masukkan Buku ke rak <span>Belum selesai dibaca</span></button>
            </form>
        </section>

        <section class="search_section">
            <h2>Cari Buku (Opsional)</h2>
            <form id="searchBook">
                <label for="searchBookTitle">Judul</label>
                <input id="searchBookTitle" type="text">
                <button id="searchSubmit" type="submit">Cari</button>
            </form>
        </section>

        <section class="book_shelf">
            <h2>Belum selesai dibaca</h2>

            <div id="incompleteBookshelfList" class="book_list">

            </div>
        </section>

        <section class="book_shelf">
            <h2>Selesai dibaca</h2>

            <div id="completeBookshelfList" class="book_list">

            </div>
        </section>
    </main>

    <script src="main.js"></script>
    <script>
        window.onload = function () {
            console.log("LOADED!!!");
            let bookMine;
            let total_item = Object.keys(localStorage);
            for (let index = 0; index < total_item.length; index++) {
                console.log(index + ' loop')
                bookMine = JSON.parse(localStorage.getItem(total_item[index]));
                appending_book(bookMine);
            }
        };

        let newBook;
        function insert_buku() {
            newBook = {
                id: Date.now(),
                title: document.getElementById("inputBookTitle").value,
                author: document.getElementById("inputBookAuthor").value,
                year: document.getElementById("inputBookYear").value,
                isComplete: document.getElementById("inputBookIsComplete").checked
            };
            console.log(newBook.id + '_' + newBook.title + '_' + newBook.author + '_' + newBook.year + '_' + newBook.isComplete);
            localStorage.setItem(newBook.id, JSON.stringify(newBook));
            appending_book(newBook);
            return false;
        }

        function appending_book(key) {
            let h31 = document.createElement("h3");
            h31.innerText = key.title;

            let p1 = document.createElement("p");
            p1.innerText = "Penulis: " + key.author;

            let p2 = document.createElement("p");
            p2.innerText = "Tahun: " + key.year;

            let buton1;
            let buton2;
            let div1;
            let articlemy;

            // IF ELSE BUTTON BEDA TEXT INSIDE
            if (key.isComplete == true) {
                buton1 = document.createElement("a");
                buton1.setAttribute("onclick", "finish_read(" + key.id + "," + true + ")");
                buton1.classList.add("green")
                buton1.style.cursor = "pointer";
                buton1.style.margin = "0px 3px 0px 0px";
                buton1.innerText = "Belum selesai dibaca";

                buton2 = document.createElement("a");
                buton2.setAttribute("onclick", "delete_read(" + key.id + ")");
                buton2.classList.add("red")
                buton2.style.cursor = "pointer";
                buton2.innerText = "Hapus buku";

                div1 = document.createElement("div");
                div1.classList.add("action")
                div1.append(buton1, buton2);

                articlemy = document.createElement("article");
                articlemy.classList.add("book_item")
                articlemy.setAttribute("id", key.id);
                articlemy.append(h31, p1, p2, div1);

                //MASUKIN ATAS
                document.getElementById("completeBookshelfList").append(articlemy);
            } else {
                buton1 = document.createElement("a");
                buton1.setAttribute("onclick", "finish_read(" + key.id + "," + false + ")");
                buton1.classList.add("green")
                buton1.style.cursor = "pointer";
                buton1.style.margin = "0px 3px 0px 0px";
                buton1.innerText = "Selesai dibaca";

                buton2 = document.createElement("a");
                buton2.setAttribute("onclick", "delete_read(" + key.id + ")");
                buton2.classList.add("red")
                buton2.style.cursor = "pointer";
                buton2.innerText = "Hapus buku";

                div1 = document.createElement("div");
                div1.classList.add("action")
                div1.append(buton1, buton2);

                articlemy = document.createElement("article");
                articlemy.classList.add("book_item")
                articlemy.setAttribute("id", key.id);
                articlemy.append(h31, p1, p2, div1);

                //MASUKIN BAWAH
                document.getElementById("incompleteBookshelfList").append(articlemy);
            }

        }

        function finish_read(key, key2) {
            let itemNew;
            let item = JSON.parse(localStorage.getItem(key));
            let choice = key2;

            console.log(item.id + '_' + item.title + '_' + item.author + '_' + item.year + '_' + item.isComplete);
            //IFELSE SEBALIKNYA
            if (key2 == true) {
                itemNew = {
                    id: item.id,
                    title: item.title,
                    author: item.author,
                    year: item.year,
                    isComplete: false
                };
            } else {
                itemNew = {
                    id: item.id,
                    title: item.title,
                    author: item.author,
                    year: item.year,
                    isComplete: true
                };
            }
            //DELETE DOM BASED ON ARTICLE ID
            document.getElementById(key).remove();
            appending_book(itemNew);
            localStorage.setItem(key, JSON.stringify(itemNew));

        }

        function delete_read(key) {
            localStorage.removeItem(key);
            document.getElementById(key).remove();
        }
    </script>
</body>

</html>